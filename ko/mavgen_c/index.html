<!DOCTYPE HTML><html lang="ko"><head><meta charset="UTF-8"><meta content="text/html; charset=utf-8"http-equiv="Content-Type"><title>C (mavgen) · MAVLink Developer Guide</title><meta content="IE=edge"http-equiv="X-UA-Compatible"/><meta content=""name="description"><meta content="GitBook 3.2.3"name="generator"><link href="../../gitbook/style.css"rel="stylesheet"><link href="../../gitbook/gitbook-plugin-anchors/plugin.css"rel="stylesheet"><link href="../../gitbook/gitbook-plugin-page-toc-button/plugin.css"rel="stylesheet"><link href="../../gitbook/gitbook-plugin-language-picker/plugin.css"rel="stylesheet"><link href="../../gitbook/gitbook-plugin-richquotes/plugin.css"rel="stylesheet"><link href="../../gitbook/gitbook-plugin-highlight/website.css"rel="stylesheet"><link href="../../gitbook/gitbook-plugin-search/search.css"rel="stylesheet"><link href="../../gitbook/gitbook-plugin-fontsettings/website.css"rel="stylesheet"><link href="../../gitbook/gitbook-plugin-theme-api/theme-api.css"rel="stylesheet"><link href="../../gitbook/gitbook-plugin-theme-dronecode/theme_styles.css"rel="stylesheet"><meta content="true"name="HandheldFriendly"/><meta content="width=device-width,initial-scale=1,user-scalable=no"name="viewport"><meta content="yes"name="apple-mobile-web-app-capable"><meta content="black"name="apple-mobile-web-app-status-bar-style"><link href="../../gitbook/images/apple-touch-icon-precomposed-152.png"rel="apple-touch-icon-precomposed"sizes="152x152"><link href="../../gitbook/images/favicon.ico"rel="shortcut icon"type="image/x-icon"><link href="message_signing_c.html"rel="next"/><link href="../getting_started/use_libraries.html"rel="prev"/></head><body><div id="common_dronecode_menu"><div class="large_version common_menu_logo"><a href="https://mavlink.io/en/"><img alt="Dronecode logo (large)"src="../../assets/site/logo_mavlink_header.png"/></a></div><div class="small_version common_menu_logo"><a href="https://mavlink.io/en/"><img alt="Dronecode logo (small)"src="../../assets/site/logo_mavlink_header.png"/></a></div><div class="common_menu_options"><div class="common_dronecode_menu_item large_version"><a href="https://mavlink.io/en/messages/common.html">Messages</a></div><div class="common_dronecode_menu_item small_version"><a href="https://mavlink.io/en/messages/common.html">Messages</a></div><div class="common_dronecode_menu_item large_version"><a href="https://mavlink.io/en/about/faq.html">FAQ</a></div><div class="common_dronecode_menu_item small_version"><a href="https://mavlink.io/en/about/faq.html">FAQ</a></div><div class="common_dronecode_menu_item large_version"><a href="https://mavlink.io/en/about/implementations.html">Implementations</a></div><div class="common_dronecode_menu_item small_version"><a href="https://mavlink.io/en/about/implementations.html">Implementations</a></div><div class="common_dronecode_menu_item large_version"><a href="https://mavlink.io/en/mavgen_c/examples.html">Examples</a></div><div class="common_dronecode_menu_item small_version"><a href="https://mavlink.io/en/mavgen_c/examples.html">Examples</a></div><div class="common_dronecode_menu_item large_version"><a href="https://mavlink.io/en/about/support.html">Support</a></div><div class="common_dronecode_menu_item small_version"><a href="https://mavlink.io/en/about/support.html">Help</a></div></div></div><div class="book"><div class="book-summary"><div id="book-search-input"role="search"><input placeholder="검색어 입력"type="text"/></div><nav role="navigation"><ul class="summary"><li class="chapter"data-level="1.1"data-path="../"><a href="../">소개</a><ul class="articles"><li class="chapter"data-level="1.1.1"data-path="../about/overview.html"><a href="../about/overview.html">개요</a></li><li class="chapter"data-level="1.1.2"data-path="../about/faq.html"><a href="../about/faq.html">자주 묻는 질문</a></li><li class="chapter"data-level="1.1.3"data-path="../about/implementations.html"><a href="../about/implementations.html">구현</a></li></ul></li><li class="chapter"data-level="1.2"data-path="../getting_started/"><a href="../getting_started/">시작하기</a><ul class="articles"><li class="chapter"data-level="1.2.1"data-path="../getting_started/installation.html"><a href="../getting_started/installation.html">MAVLink 설치하기</a></li><li class="chapter"data-level="1.2.2"data-path="../getting_started/generate_libraries.html"><a href="../getting_started/generate_libraries.html">MAVLink 라이브러리 생성하기</a></li><li class="chapter"data-level="1.2.3"data-path="../getting_started/ros.html"><a href="../getting_started/ros.html">ROS용 소스 코드 파일 생성하기</a></li></ul></li><li class="chapter"data-level="1.3"data-path="../getting_started/use_libraries.html"><a href="../getting_started/use_libraries.html">MAVLink 라이브러리 사용법</a><ul class="articles"><li class="chapter active"data-level="1.3.1"data-path="./"><a href="./">C (mavgen)</a><ul class="articles"><li class="chapter"data-level="1.3.1.1"data-path="message_signing_c.html"><a href="message_signing_c.html">메세지 서명</a></li><li class="chapter"data-level="1.3.1.2"data-path="examples.html"><a href="examples.html">예제</a><ul class="articles"><li class="chapter"data-level="1.3.1.2.1"data-path="example_c_uart.html"><a href="example_c_uart.html">UART 인터페이스 (C)</a></li><li class="chapter"data-level="1.3.1.2.2"data-path="example_c_udp.html"><a href="example_c_udp.html">UDP 예시 (C)</a></li></ul></li></ul></li><li class="chapter"data-level="1.3.2"data-path="../mavgen_python/"><a href="../mavgen_python/">Python (mavgen)</a></li></ul></li><li class="chapter"data-level="1.4"data-path="../guide/"><a href="../guide/">안내서</a><ul class="articles"><li class="chapter"data-level="1.4.1"data-path="../guide/mavlink_version.html"><a href="../guide/mavlink_version.html">MAVLink 버전</a></li><li class="chapter"data-level="1.4.2"data-path="../guide/mavlink_2.html"><a href="../guide/mavlink_2.html">MAVLink 2</a></li><li class="chapter"data-level="1.4.3"data-path="../guide/message_signing.html"><a href="../guide/message_signing.html">메세지 서명</a></li><li class="chapter"data-level="1.4.4"data-path="../guide/serialization.html"><a href="../guide/serialization.html">직렬화</a></li><li class="chapter"data-level="1.4.5"data-path="../guide/routing.html"><a href="../guide/routing.html">라우팅</a></li><li class="chapter"data-level="1.4.6"data-path="../guide/general_telemetry.html"><a href="../guide/general_telemetry.html">범용 텔레메트리</a></li><li class="chapter"data-level="1.4.7"data-path="../guide/offboard_control.html"><a href="../guide/offboard_control.html">보드 외부 요소 제어</a></li><li class="chapter"data-level="1.4.8"data-path="../file_formats/"><a href="../file_formats/">파일 형식</a></li><li class="chapter"data-level="1.4.9"data-path="../guide/uavcan_interaction.html"><a href="../guide/uavcan_interaction.html">UAVCAN 통신</a></li><li class="chapter"data-level="1.4.10"data-path="../guide/scripts.html"><a href="../guide/scripts.html">스크립트</a></li><li class="chapter"data-level="1.4.11"data-path="../guide/xml_schema.html"><a href="../guide/xml_schema.html">MAVLink XML 스키마</a></li><li class="chapter"data-level="1.4.12"data-path="../guide/define_xml_element.html"><a href="../guide/define_xml_element.html">XML 기수/메세지 정의</a></li><li class="chapter"data-level="1.4.13"data-path="../guide/crc.html"><a href="../guide/crc.html">MAVLink CRC</a></li><li class="chapter"data-level="1.4.14"data-path="../guide/wireshark.html"><a href="../guide/wireshark.html">Debugging with Wireshark</a></li><li class="chapter"data-level="1.4.15"data-path="../messages/"><a href="../messages/">Dialects</a><ul class="articles"><li class="chapter"data-level="1.4.15.1"data-path="../messages/ASLUAV.html"><a href="../messages/ASLUAV.html">ASLUAV.xml</a></li><li class="chapter"data-level="1.4.15.2"data-path="../messages/all.html"><a href="../messages/all.html">all.xml</a></li><li class="chapter"data-level="1.4.15.3"data-path="../messages/ardupilotmega.html"><a href="../messages/ardupilotmega.html">ardupilotmega.xml</a></li><li class="chapter"data-level="1.4.15.4"data-path="../messages/autoquad.html"><a href="../messages/autoquad.html">autoquad.xml</a></li><li class="chapter"data-level="1.4.15.5"data-path="../messages/development.html"><a href="../messages/development.html">development.xml</a></li><li class="chapter"data-level="1.4.15.6"data-path="../messages/icarous.html"><a href="../messages/icarous.html">icarous.xml</a></li><li class="chapter"data-level="1.4.15.7"data-path="../messages/matrixpilot.html"><a href="../messages/matrixpilot.html">matrixpilot.xml</a></li><li class="chapter"data-level="1.4.15.8"data-path="../messages/minimal.html"><a href="../messages/minimal.html">minimal.xml</a></li><li class="chapter"data-level="1.4.15.9"data-path="../messages/paparazzi.html"><a href="../messages/paparazzi.html">paparazzi.xml</a></li><li class="chapter"data-level="1.4.15.10"data-path="../messages/python_array_test.html"><a href="../messages/python_array_test.html">python_array_test.xml</a></li><li class="chapter"data-level="1.4.15.11"data-path="../messages/standard.html"><a href="../messages/standard.html">standard.xml</a></li><li class="chapter"data-level="1.4.15.12"data-path="../messages/test.html"><a href="../messages/test.html">test.xml</a></li><li class="chapter"data-level="1.4.15.13"data-path="../messages/uAvionix.html"><a href="../messages/uAvionix.html">uAvionix.xml</a></li><li class="chapter"data-level="1.4.15.14"data-path="../messages/ualberta.html"><a href="../messages/ualberta.html">ualberta.xml</a></li></ul></li></ul></li><li class="chapter"data-level="1.5"data-path="../messages/common.html"><a href="../messages/common.html">메세지 (공통)</a></li><li class="chapter"data-level="1.6"data-path="../services/"><a href="../services/">Microservices</a><ul class="articles"><li class="chapter"data-level="1.6.1"data-path="../services/heartbeat.html"><a href="../services/heartbeat.html">주기 신호/연결 프로토콜</a></li><li class="chapter"data-level="1.6.2"data-path="../services/mission.html"><a href="../services/mission.html">미션 프로토콜</a></li><li class="chapter"data-level="1.6.3"data-path="../services/parameter.html"><a href="../services/parameter.html">매개변수 프로토콜</a></li><li class="chapter"data-level="1.6.4"data-path="../services/parameter_ext.html"><a href="../services/parameter_ext.html">Extended Parameter Protocol</a></li><li class="chapter"data-level="1.6.5"data-path="../services/command.html"><a href="../services/command.html">Command Protocol</a></li><li class="chapter"data-level="1.6.6"data-path="../services/manual_control.html"><a href="../services/manual_control.html">Manual Control (Joystick) Protocol</a></li><li class="chapter"data-level="1.6.7"data-path="../services/camera.html"><a href="../services/camera.html">Camera Protocol</a><ul class="articles"><li class="chapter"data-level="1.6.7.1"data-path="../services/camera_def.html"><a href="../services/camera_def.html">Camera Definition</a></li></ul></li><li class="chapter"data-level="1.6.8"data-path="../services/gimbal_v2.html"><a href="../services/gimbal_v2.html">Gimbal Protocol v2</a><ul class="articles"><li class="chapter"data-level="1.6.8.1"data-path="../services/gimbal.html"><a href="../services/gimbal.html">Gimbal Protocol v1 (superseded)</a></li></ul></li><li class="chapter"data-level="1.6.9"data-path="../services/arm_authorization.html"><a href="../services/arm_authorization.html">Arm Authorization Protocol</a></li><li class="chapter"data-level="1.6.10"data-path="../services/image_transmission.html"><a href="../services/image_transmission.html">Image Transmission Protocol</a></li><li class="chapter"data-level="1.6.11"data-path="../services/ftp.html"><a href="../services/ftp.html">File Transfer Protocol (FTP)</a></li><li class="chapter"data-level="1.6.12"data-path="../services/landing_target.html"><a href="../services/landing_target.html">Landing Target Protocol</a></li><li class="chapter"data-level="1.6.13"data-path="../services/ping.html"><a href="../services/ping.html">Ping Protocol</a></li><li class="chapter"data-level="1.6.14"data-path="../services/trajectory.html"><a href="../services/trajectory.html">Path Planning (Trajectory) Protocol</a></li><li class="chapter"data-level="1.6.15"data-path="../services/battery.html"><a href="../services/battery.html">Battery Protocol</a></li><li class="chapter"data-level="1.6.16"data-path="../services/terrain.html"><a href="../services/terrain.html">Terrain Protocol</a></li><li class="chapter"data-level="1.6.17"data-path="../services/tunnel.html"><a href="../services/tunnel.html">Tunnel Protocol</a></li><li class="chapter"data-level="1.6.18"data-path="../services/opendroneid.html"><a href="../services/opendroneid.html">Open Drone ID Protocol</a></li><li class="chapter"data-level="1.6.19"data-path="../services/high_latency.html"><a href="../services/high_latency.html">High Latency Protocol</a></li><li class="chapter"data-level="1.6.20"data-path="../services/component_information.html"><a href="../services/component_information.html">Component Metadata Protocol (WIP)</a></li><li class="chapter"data-level="1.6.21"data-path="../services/payload.html"><a href="../services/payload.html">Payload Protocols</a></li><li class="chapter"data-level="1.6.22"data-path="../services/traffic_management.html"><a href="../services/traffic_management.html">Traffic Managment (UTM/ADS-B)</a></li><li class="chapter"data-level="1.6.23"data-path="../services/events.html"><a href="../services/events.html">Events Interface (WIP)</a></li><li class="chapter"data-level="1.6.24"data-path="../services/timesync.html"><a href="../services/timesync.html">Time Synchronization</a></li></ul></li><li class="chapter"data-level="1.7"data-path="../contributing/contributing.html"><a href="../contributing/contributing.html">Contributing</a></li><li class="chapter"data-level="1.8"data-path="../about/support.html"><a href="../about/support.html">지원</a></li><li class="divider"></li><li><a href="https://www.gitbook.com"class="gitbook-link"target="blank">GitBook에 게시</a></li></ul></nav></div><div class="book-body"><div class="body-inner"><div class="book-header"role="navigation"><h1><i class="fa fa-circle-o-notch fa-spin"></i> <a href="..">C (mavgen)</a></h1></div><div class="page-wrapper"role="main"tabindex="-1"><div class="page-inner"><div id="book-search-results"><div class="search-noresults"><section class="markdown-section normal"><h1 id="using-c-mavlink-libraries-mavgen"><a href="#using-c-mavlink-libraries-mavgen"class="plugin-anchor"name="using-c-mavlink-libraries-mavgen"><i class="fa fa-link"aria-hidden="true"></i></a>Using C MAVLink Libraries (mavgen)</h1><p>The MAVLink C library generated by <em>mavgen</em> is a header-only implementation that is highly optimized for resource-constrained systems with limited RAM and flash memory. It is field-proven and deployed in many products where it serves as interoperability interface between components of different manufacturers.</p><p>This topic explains how to get and use the library.</p><h2 id="get_libraries"><a href="#get_libraries"class="plugin-anchor"name="get_libraries"><i class="fa fa-link"aria-hidden="true"></i></a>Getting the C MAVLink Libraries</h2><p>If you are using a <a href="../messages/#dialects">standard dialect</a> then download the <em>MAVLink 2</em> library from Github: <a href="https://github.com/mavlink/c_library_v2"target="_blank">c_library_v2</a>.</p><blockquote class="alert clearfix alert-success"><strong class="fa fa-2x fa-thumbs-o-up"></strong><p>The MAVLink 2 library supports both MAVLink 2 and MAVLink 1, and is rebuilt for all the <em>standard dialects</em> whenever any of the definitions in the <em>mavlink/mavlink</em> repo change. It supersedes the MAVLink 1 library (<a href="https://github.com/mavlink/c_library_v1"target="_blank">c_library_v1</a>), and should be used by preference.</p></blockquote><p>If you need libraries for a custom dialect then you will need to <a href="../getting_started/installation.html">install mavgen</a> and <a href="../getting_started/generate_libraries.html">generate</a> them yourself. These can then be used in the same way as the pre-generated libraries.</p><p>The libraries can be placed/generated anywhere in your project tree. The example below shows them located in: <strong>generated/include/mavlink/v2.0/</strong>.</p><h2 id="adding-libraries"><a href="#adding-libraries"class="plugin-anchor"name="adding-libraries"><i class="fa fa-link"aria-hidden="true"></i></a>Adding Libraries</h2><p>To use MAVLink in your C project, include the <strong>mavlink.h</strong> header file for your dialect:</p><pre><code class="lang-c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;your_dialect/mavlink.h&gt;</span></span>
</code></pre><p>This will automatically add the header files for all messages in your dialect, and for any dialect files that it includes.</p><blockquote class="alert clearfix alert-warning"><strong class="fa fa-2x fa-exclamation-triangle"></strong><p>Only include the header file for a single dialect. If you need to support messages from a <em>number of dialects</em> then create a new &quot;parent&quot; dialect XML file that includes them (and use its generated header as shown above).</p></blockquote><p><a></a></p><blockquote class="alert clearfix alert-success"><strong class="fa fa-2x fa-thumbs-o-up"></strong><p><em>Do not include the individual message files</em>. If you generate your own headers, you will have to add their output location to your C compiler&apos;s search path.</p></blockquote><p>When compiling the project, we recommend that you specify the top-level output directory AND all generated dialects and versions (this will give the greatest compatibility with existing code and examples):</p><pre><code class="lang-sh">$ gcc ... -I generated/include -I generated/include/common ...
</code></pre><p>In order to <em>send messages</em> you will also need to declare a variable <code>mavlink_system</code> in the <strong>global scope</strong>, specifying the system id and component ID of your component:</p><pre><code class="lang-cpp"><span class="hljs-keyword">mavlink_system_t</span> mavlink_system = {
    <span class="hljs-number">1</span>, <span class="hljs-comment">// System ID (1-255)</span>
    <span class="hljs-number">1</span>  <span class="hljs-comment">// Component ID (a MAV_COMPONENT value)</span>
};
</code></pre><h3 id="build-warnings"><a href="#build-warnings"class="plugin-anchor"name="build-warnings"><i class="fa fa-link"aria-hidden="true"></i></a>Build Warnings</h3><h4 id="waddress-of-packed-member"><a href="#waddress-of-packed-member"class="plugin-anchor"name="waddress-of-packed-member"><i class="fa fa-link"aria-hidden="true"></i></a><code>-Waddress-of-packed-member</code></h4><p>Building the headers may result in warnings like:</p><pre><code>mavlink/common/../mavlink_helpers.h:86:24: warning: taking address of packed member of &#x2018;__mavlink_message&#x2019; may result in an unaligned pointer value [-Waddress-of-packed-member]
   86 |  crc_accumulate_buffer(&amp;msg-&gt;checksum, _MAV_PAYLOAD(msg), msg-&gt;len);
</code></pre><p>These can be ignored because MAVLink re-orders packed structures such that values are properly aligned. Specifically all 4-byte values are aligned on 4-byte boundaries (by putting them first), all 2-byte values come after those and are hence also aligned, and last of all come the the 1-byte values.</p><p>You can supress the warnings in CMake using <code>target_compile_options(mavlink_c INTERFACE -Wno-address-of-packed-member -Wno-cast-align)</code>.</p><h2 id="upgrading-library-from-mavlink-1"><a href="#upgrading-library-from-mavlink-1"class="plugin-anchor"name="upgrading-library-from-mavlink-1"><i class="fa fa-link"aria-hidden="true"></i></a>Upgrading Library from MAVLink 1</h2><p>The <em>MAVLink 1</em> pre-built library <a href="https://github.com/mavlink/c_library_v1"target="_blank">mavlink/c_library_v1</a> can be upgraded by simply dropping in the <em>MAVLink 2</em> library from Github: <a href="https://github.com/mavlink/c_library_v2"target="_blank">mavlink/c_library_v2</a>.</p><p>The <em>MAVLink 2</em> C library offers the same range of APIs as was offered by <em>MAVLink 1</em>.</p><blockquote class="alert clearfix alert-info"><strong class="fa fa-2x fa-edit"></strong><p>The major change from an API perspective is that you don&apos;t need to provide a message CRC table any more, or message length table. These have been folded into a single packed table, replacing the old table which was indexed by <code>msgId</code>. That was necessary to cope with the much larger 24 bit namespace of message IDs.</p></blockquote><p><em>MAVLink 2</em> usage is covered in the following sections (this includes <a href="#mavlink_1">Working with MAVLink 1</a> which explains how you can communicate with both <em>MAVLink 2</em> and <em>MAVLink 1</em> (only) libraries.</p><h2 id="channels"><a href="#channels"class="plugin-anchor"name="channels"><i class="fa fa-link"aria-hidden="true"></i></a>Multiple Streams (&quot;channels&quot;)</h2><p>The C MAVLink library utilizes a &quot;channel&quot; metaphor to allow for simultaneous processing of multiple, independent MAVLink streams in the same program. All receiving and transmitting functions provided by this library require a channel, and it is important to use the correct channel for each operation.</p><p>By default up to 16 channels may be defined on Windows, Linux and macOS, and up to 4 channels may be define on other systems. Systems can specify a different maximum number of channels/comms buffers using <code>MAVLINK_COMM_NUM_BUFFERS</code> (for example, this might be reduced to 1 if running MAVLink on very memory constrained hardware).</p><p>If only one MAVLink stream exists, channel 0 should be used by specifying the <code>MAVLINK_COMM_0</code> constant.</p><h2 id="receiving"><a href="#receiving"class="plugin-anchor"name="receiving"><i class="fa fa-link"aria-hidden="true"></i></a>Receiving</h2><p>MAVLink reception/decoding is done in a number of phases:</p><ol><li>Parse the incoming stream into objects representing each packet (<code>mavlink_message_t</code>).</li><li>Decode the MAVLink message contained in the packet payload into a C struct (that has fields mapping the original XML definition).</li></ol><p>These steps are demonstrated below.</p><h3 id="parsing-packets"><a href="#parsing-packets"class="plugin-anchor"name="parsing-packets"><i class="fa fa-link"aria-hidden="true"></i></a>Parsing Packets</h3><p>The <code>mavlink_parse_char(...)</code> convenience function (<a href="https://github.com/mavlink/c_library_v2/blob/master/mavlink_helpers.h"target="_blank">mavlink_helpers.h</a>) is used to parse incoming MAVLink data. The function parses the data one byte at a time, returning 0 (<code>MAVLINK_FRAMING_INCOMPLETE</code>) as it progresses, and 1 (<code>MAVLINK_FRAMING_OK</code>) on successful decoding of a packet. The <code>r_mavlink_status</code> parameter is updated with the channel status/errors as decoding progresses (you can check <code>mavlink_status_t.msg_received</code> to get the current byte&apos;s decode status/error and <code>mavlink_status_t.parse_state</code> for the current parse state). On successful decoding of a packet, the <code>r_message</code> argument is populated with an object representing the decoded packet.</p><p>The function prototype and parameters are shown below:</p><pre><code class="lang-c"><span class="hljs-function">MAVLINK_HELPER uint8_t <span class="hljs-title">mavlink_parse_char</span><span class="hljs-params">(uint8_t chan, uint8_t c, mavlink_message_t* r_message, mavlink_status_t* r_mavlink_status)</span>
</span></code></pre><p>Parameters:</p><ul><li><code>uint8_t chan</code>: ID of the current channel.</li><li><code>uint8_t c</code>: The char to parse.</li><li><a href="https://github.com/ArduPilot/pymavlink/blob/c0f5bb2695a677721aa7bb8f20be40ba8274c3d4/generator/C/include_v2.0/mavlink_types.h#L108"target="_blank"><code>mavlink_message_t*</code></a> <code>r_message</code>: On success, the decoded message. NULL if the message couldn&apos;t be decoded.</li><li><a href="https://github.com/ArduPilot/pymavlink/blob/c0f5bb2695a677721aa7bb8f20be40ba8274c3d4/generator/C/include_v2.0/mavlink_types.h#L217"target="_blank"><code>mavlink_status_t*</code></a> <code>r_mavlink_status</code>: The channel statistics, including information about the current parse state.</li></ul><p>Returns: <code>0</code> if the packet decoding is incomplete. <code>1</code> if the packet successfully decoded.</p><p>The code fragment below shows the typical use of this function when reading data from a serial port (<code>serial</code>):</p><pre><code class="lang-cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;common/mavlink.h&gt;</span></span>

<span class="hljs-keyword">mavlink_status_t</span> status;
<span class="hljs-keyword">mavlink_message_t</span> msg;
<span class="hljs-keyword">int</span> chan = MAVLINK_COMM_0;

<span class="hljs-keyword">while</span>(serial.bytesAvailable &gt; <span class="hljs-number">0</span>)
{
  <span class="hljs-keyword">uint8_t</span> byte = serial.getNextByte();
  <span class="hljs-keyword">if</span> (mavlink_parse_char(chan, byte, &amp;msg, &amp;status))
    {
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Received message with ID %d, sequence: %d from component %d of system %d\n&quot;</span>, msg.msgid, msg.seq, msg.compid, msg.sysid);
    <span class="hljs-comment">// ... DECODE THE MESSAGE PAYLOAD HERE ...</span>
    }
}
</code></pre><blockquote class="alert clearfix alert-success"><strong class="fa fa-2x fa-thumbs-o-up"></strong><p>The <a href="https://github.com/mavlink/c_library_v2/blob/master/mavlink_helpers.h"target="_blank">mavlink_helpers.h</a> include other parser functions: <code>mavlink_frame_char()</code> and <code>mavlink_frame_char_buffer()</code>. Generally you will want to use <code>mavlink_parse_char()</code> (which calls those functions internally), but reviewing the other methods can give you a better understanding of the parsing process.</p></blockquote><h3 id="decode_payload"><a href="#decode_payload"class="plugin-anchor"name="decode_payload"><i class="fa fa-link"aria-hidden="true"></i></a>Decoding the Payload</h3><p>The message/packet object retrieved in the previous section(<code>mavlink_message_t</code>) contains fields in the <a href="../guide/serialization.html">MAVLink packet/serialization</a> format - including the message id (<code>msgid</code>) and the payload (<code>payload64</code>).</p><p>To get the fields of the <em>specific message</em> in the packet you need to further decode the payload. This is typically done by providing a <code>case</code> statement that maps the <em>ids</em> of the messages you wish to decode to appropriate decoder functions. The code fragment below shows this for two messages (the first decodes a whole message into a C struct, while the second gets just a single field):</p><pre><code class="lang-c"><span class="hljs-keyword">if</span> (mavlink_parse_char(chan, byte, &amp;msg, &amp;status)) {
...
</code></pre><pre><code class="lang-c">    <span class="hljs-keyword">switch</span>(msg.msgid) {
      <span class="hljs-keyword">case</span> MAVLINK_MSG_ID_GLOBAL_POSITION_INT: <span class="hljs-comment">// ID for GLOBAL_POSITION_INT</span>
        {
          <span class="hljs-comment">// Get all fields in payload (into global_position)</span>
          mavlink_msg_global_position_int_decode(&amp;msg, &amp;global_position);

        }
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> MAVLINK_MSG_ID_GPS_STATUS:
        {
          <span class="hljs-comment">// Get just one field from payload</span>
          visible_sats = mavlink_msg_gps_status_get_satellites_visible(&amp;msg);
        }
        <span class="hljs-keyword">break</span>;
     <span class="hljs-keyword">default</span>:
        <span class="hljs-keyword">break</span>;
    }
</code></pre><pre><code class="lang-c">...
}
</code></pre><p>The decoder/encoder functions and ids for each message in a dialect can be found in separate header files under the dialect folder. The headers are named with a format including the message name (<strong>mavlink*msg</strong>message_name<em>.h*</em>)</p><blockquote class="alert clearfix alert-success"><strong class="fa fa-2x fa-thumbs-o-up"></strong><p>Individual message definitions for the dialect are pulled in when you include <strong>mavlink.h</strong> for your dialect, so you don&apos;t need to include these separately.</p></blockquote><p>The most useful decoding function is named with the pattern <strong>mavlink*msg</strong>message_name<em>_decode()*</em>, and extracts the whole payload into a C struct (with fields mapping to the original XML message definition). There are also separate decoder functions to just get the values of individual fields.</p><p>For example, the common message <a href="../messages/common.html#GLOBAL_POSITION_INT">GLOBAL_POSITION_INT</a> is generated to <a href="https://github.com/mavlink/c_library_v2/blob/master/common/mavlink_msg_global_position_int.h"target="_blank">common/mavlink_msg_global_position_int.h</a>, and contains the following definitions:</p><pre><code class="lang-c"><span class="hljs-comment">// Message ID number definition</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAVLINK_MSG_ID_GLOBAL_POSITION_INT 33</span>

<span class="hljs-comment">// Function to decode whole message into C struct</span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-keyword">void</span> <span class="hljs-title">mavlink_msg_global_position_int_decode</span><span class="hljs-params">(<span class="hljs-keyword">const</span> mavlink_message_t* msg, mavlink_global_position_int_t* global_position_int)</span>

<span class="hljs-comment">// C-struct with fields mapping to original message</span>
<span class="hljs-title">MAVPACKED</span><span class="hljs-params">(
<span class="hljs-keyword">typedef</span> <span class="hljs-keyword">struct</span> __mavlink_global_position_int_t {
 uint32_t time_boot_ms; <span class="hljs-comment">/*&lt; [ms] Timestamp (time since system boot).*/</span>
 int32_t lat; <span class="hljs-comment">/*&lt; [degE7] Latitude, expressed*/</span>
 int32_t lon; <span class="hljs-comment">/*&lt; [degE7] Longitude, expressed*/</span>
 int32_t alt; <span class="hljs-comment">/*&lt; [mm] Altitude (MSL). Note that virtually all GPS modules provide both WGS84 and MSL.*/</span>
 int32_t relative_alt; <span class="hljs-comment">/*&lt; [mm] Altitude above ground*/</span>
 int16_t vx; <span class="hljs-comment">/*&lt; [cm/s] Ground X Speed (Latitude, positive north)*/</span>
 int16_t vy; <span class="hljs-comment">/*&lt; [cm/s] Ground Y Speed (Longitude, positive east)*/</span>
 int16_t vz; <span class="hljs-comment">/*&lt; [cm/s] Ground Z Speed (Altitude, positive down)*/</span>
 uint16_t hdg; <span class="hljs-comment">/*&lt; [cdeg] Vehicle heading (yaw angle), 0.0..359.99 degrees. If unknown, set to: UINT16_MAX*/</span>
})</span> mavlink_global_position_int_t</span>;

<span class="hljs-comment">// Function to get just a single field from the payload (in this case, the altitude).</span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">inline</span> int32_t <span class="hljs-title">mavlink_msg_global_position_int_get_alt</span><span class="hljs-params">(<span class="hljs-keyword">const</span> mavlink_message_t* msg)</span>
</span></code></pre><h3 id="decode_command"><a href="#decode_command"class="plugin-anchor"name="decode_command"><i class="fa fa-link"aria-hidden="true"></i></a>Command Decoding</h3><p>A <a href="../services/command.html">MAVLink Command</a> encodes a command defined in a <a href="../messages/common.html#mav_commands">MAV_CMD</a> enum value into a <a href="../messages/common.html#COMMAND_INT">COMMAND_INT</a> or <a href="../messages/common.html#COMMAND_LONG">COMMAND_LONG</a> message.</p><p>Command packets are parsed and decoded in the same way as <a href="#decode_payload">any other payload</a> - i.e. you switch on message id of <code>MAVLINK_MSG_ID_COMMAND_INT</code>/<code>MAVLINK_MSG_ID_COMMAND_LONG</code> and call the decoder functions <code>mavlink_msg_command_int_decode()</code>/<code>mavlink_msg_command_long_decode()</code> (respectively) to get a C struct mapping the original message.</p><blockquote class="alert clearfix alert-info"><strong class="fa fa-2x fa-edit"></strong><p>The message types differ in that <code>COMMAND_INT</code> has <code>int32</code> types for parameter fields 6 and 7 (instead of <code>float</code>) and also includes a field for the geometric frame of reference of any positional information in the command.</p></blockquote><p>To decode the specific command you then switch on the value of the <code>mavlink_command_int_t.command</code> or <code>mavlink_command_long_t.command</code> field, which contains the particular <code>MAV_CMD</code> id.</p><p>Further interpretation and handling of the message then has to be done manually (there are no convenience functions).</p><h3 id="additional-checks"><a href="#additional-checks"class="plugin-anchor"name="additional-checks"><i class="fa fa-link"aria-hidden="true"></i></a>Additional Checks</h3><p>The library have a number of <code>#define</code> values that you can set to enable various features:</p><ul><li><code>MAVLINK_CHECK_MESSAGE_LENGTH</code>: Enable this option to check the length of each message. This allows invalid messages to be caught much sooner. Use if the transmission medium is prone to missing (or extra) characters (e.g. a radio that fades in and out). Only use if the channel will only contain messages types listed in the headers.</li></ul><h2 id="transmitting"><a href="#transmitting"class="plugin-anchor"name="transmitting"><i class="fa fa-link"aria-hidden="true"></i></a>Transmitting</h2><p>Transmitting messages can be done by using the <code>mavlink_msg_*_pack()</code> function, where one is defined for every message. The packed message can then be serialized with <code>mavlink_helpers.h:mavlink_msg_to_send_buffer()</code> and then writing the resultant byte array out over the appropriate serial interface.</p><p>It is possible to simplify the above by writing wrappers around the transmitting/receiving code. A multi-byte writing macro can be defined, <code>MAVLINK_SEND_UART_BYTES()</code>, or a single-byte function can be defined, <code>comm_send_ch()</code>, that wrap the low-level driver for transmitting the data. If this is done, <code>MAVLINK_USE_CONVENIENCE_FUNCTIONS</code> must be defined.</p><h2 id="message-signing"><a href="#message-signing"class="plugin-anchor"name="message-signing"><i class="fa fa-link"aria-hidden="true"></i></a>Message Signing</h2><p><a href="../guide/message_signing.html">Message Signing (authentication)</a> allows a <em>MAVLink 2</em> system to verify that messages originate from a trusted source.</p><p>The C libraries generated by <em>mavgen</em> provide <em>almost everything</em> needed to support message signing in your MAVLink system. The topic <a href="message_signing_c.html">C Message Signing</a> explains the remaining code that a system must implement to enable signing using the C library.</p><h2 id="mavlink_1"><a href="#mavlink_1"class="plugin-anchor"name="mavlink_1"><i class="fa fa-link"aria-hidden="true"></i></a>Working with MAVLink 1</h2><p>This section explains how to use the MAVLink 2 C library to work with MAVLink 1 systems.</p><h3 id="version-handshakingnegotiation"><a href="#version-handshakingnegotiation"class="plugin-anchor"name="version-handshakingnegotiation"><i class="fa fa-link"aria-hidden="true"></i></a>Version Handshaking/Negotiation</h3><p><a href="../guide/mavlink_version.html">MAVLink Versions</a> explains the <a href="../guide/mavlink_version.html#version_handshaking">handshaking</a> used to determine the supported MAVLink version of either end of the channel, and how to <a href="../guide/mavlink_version.html#negotiating_versions">negotiate the version to use</a>.</p><h3 id="sending-and-receiving-mavlink-1-packets"><a href="#sending-and-receiving-mavlink-1-packets"class="plugin-anchor"name="sending-and-receiving-mavlink-1-packets"><i class="fa fa-link"aria-hidden="true"></i></a>Sending and Receiving MAVLink 1 Packets</h3><p>The <em>MAVLink 2</em> library will send packets in <em>MAVLink 2</em> framing by default. To force sending <em>MAVLink 1</em> packets on a particular channel you change the flags field of the status object.</p><p>For example, the following code causes subsequent packets on the given channel to be sent as <em>MAVLink 1</em>:</p><pre><code class="lang-C"><span class="hljs-keyword">mavlink_status_t</span>* chan_state = mavlink_get_channel_status(MAVLINK_COMM_0);
chan_state-&gt;flags |= MAVLINK_STATUS_FLAG_OUT_MAVLINK1;
</code></pre><p>Incoming <em>MAVLink 1</em> packets will be automatically handled as <em>MAVLink 1</em>. If you need to determine if a particular message was received as <em>MAVLink 1</em> or <em>MAVLink 2</em> then you can use the <code>magic</code> field of the message. In c programming, this is done like this:</p><pre><code class="lang-c"><span class="hljs-keyword">if</span> (msg-&gt;magic == MAVLINK_STX_MAVLINK1) {
   <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;This is a MAVLink 1 message\n&quot;</span>);
}
</code></pre><p>In most cases this should not be necessary as the XML message definition files for <em>MAVLink 1</em> and <em>MAVLink 2</em> are the same, so you can treat incoming <em>MAVLink 1</em> messages the same as <em>MAVLink 2</em> messages.</p><blockquote class="alert clearfix alert-info"><strong class="fa fa-2x fa-edit"></strong><p><em>MAVLink 1</em> is restricted to message IDs less than 256, so any messages with a higher message ID won&apos;t be received as <em>MAVLink 1</em>.</p></blockquote><p>It is advisable to switch to <em>MAVLink 2</em> when the communication partner sends <em>MAVLink 2</em> (see <a href="../guide/mavlink_version.html#version_handshaking">Version Handshaking</a>). The minimal solution is to watch incoming packets using code similar to this:</p><pre><code class="lang-C"><span class="hljs-keyword">if</span> (mavlink_parse_char(MAVLINK_COMM_0, buf[i], &amp;msg, &amp;status)) {

    <span class="hljs-comment">// check if we received version 2 and request a switch.</span>
    <span class="hljs-keyword">if</span> (!(mavlink_get_channel_status(MAVLINK_COMM_0)-&gt;flags &amp; MAVLINK_STATUS_FLAG_IN_MAVLINK1)) {
        <span class="hljs-comment">// this will only switch to proto version 2</span>
        chan_state-&gt;flags &amp;= ~(MAVLINK_STATUS_FLAG_OUT_MAVLINK1);
    }
}
</code></pre><h2 id="examples"><a href="#examples"class="plugin-anchor"name="examples"><i class="fa fa-link"aria-hidden="true"></i></a>Examples</h2><p>The following examples show the use of the API.</p><ul><li><a href="example_c_uart.html">UART Interface</a>: Simple C example of a MAVLink to UART interface for Unix-like systems.</li><li><a href="example_c_udp.html">UDP Example</a>: Simple C example of a MAVLink UDP interface for Unix-like systems (Linux, MacOS, BSD, etc.).</li></ul><p>In addition, the C library is used in numerous open source systems:</p><ul><li><a href="https://github.com/PX4/Firmware/blob/master/src/modules/mavlink/mavlink_receiver.cpp"target="_blank">PX4</a></li><li><a href="https://github.com/ArduPilot/ardupilot/blob/master/libraries/GCS_MAVLink/GCS_Common.cpp"target="_blank">ArduPilot</a></li><li><a href="https://github.com/mavlink/MAVSDK/blob/develop/src/core/mavlink_receiver.cpp#L28-L51"target="_blank">MAVSDK</a></li></ul></section></div><div class="search-results"><div class="has-results"><h1 class="search-results-title"><span class="search-results-count"></span> results matching "<span class="search-query"></span>"</h1><ul class="search-results-list"></ul></div><div class="no-results"><h1 class="search-results-title">No results matching "<span class="search-query"></span>"</h1></div></div></div></div></div></div></div><script>var gitbook=gitbook||[];gitbook.push(function(){gitbook.page.hasChanged({page:{title:"C (mavgen)",level:"1.3.1",depth:2,next:{title:"메세지 서명",level:"1.3.1.1",depth:3,path:"mavgen_c/message_signing_c.md",ref:"mavgen_c/message_signing_c.md",articles:[]},previous:{title:"MAVLink 라이브러리 사용법",level:"1.3",depth:1,path:"getting_started/use_libraries.md",ref:"getting_started/use_libraries.md",articles:[{title:"C (mavgen)",level:"1.3.1",depth:2,path:"mavgen_c/README.md",ref:"mavgen_c/README.md",articles:[{title:"메세지 서명",level:"1.3.1.1",depth:3,path:"mavgen_c/message_signing_c.md",ref:"mavgen_c/message_signing_c.md",articles:[]},{title:"예제",level:"1.3.1.2",depth:3,path:"mavgen_c/examples.md",ref:"mavgen_c/examples.md",articles:[{title:"UART 인터페이스 (C)",level:"1.3.1.2.1",depth:4,path:"mavgen_c/example_c_uart.md",ref:"mavgen_c/example_c_uart.md",articles:[]},{title:"UDP 예시 (C)",level:"1.3.1.2.2",depth:4,path:"mavgen_c/example_c_udp.md",ref:"mavgen_c/example_c_udp.md",articles:[]}]}]},{title:"Python (mavgen)",level:"1.3.2",depth:2,path:"mavgen_python/README.md",ref:"mavgen_python/README.md",articles:[]}]},dir:"ltr"},config:{plugins:["theme-api","youtube","anchors","collapsible-menu","page-toc-button","language-picker","custom-favicon","richquotes@git+https://github.com/Dronecode/gitbook-plugin-richquotes.git","bulk-redirect@git+https://github.com/Dronecode/gitbook-plugin-bulk-redirect.git","toolbar@git+https://github.com/hamishwillee/gitbook-plugin-toolbar.git","-mermaid","theme-dronecode@git+https://github.com/dronecode/theme-dronecode.git","html-minifier"],styles:{website:"styles/website.css",pdf:"styles/pdf.css",epub:"styles/epub.css",mobi:"styles/mobi.css",ebook:"styles/ebook.css",print:"styles/print.css"},pluginsConfig:{"theme-dronecode":{logo:{logo_large:"../assets/site/logo_mavlink_header.png",logo_small:"../assets/site/logo_mavlink_header.png",url:"https://mavlink.io/en/"},menu:[{url:"https://mavlink.io/en/messages/common.html",text:"Messages",text_small:"Messages"},{url:"https://mavlink.io/en/about/faq.html",text:"FAQ",text_small:"FAQ"},{url:"https://mavlink.io/en/about/implementations.html",text:"Implementations",text_small:"Implementations"},{url:"https://mavlink.io/en/mavgen_c/examples.html",text:"Examples",text_small:"Examples"},{url:"https://mavlink.io/en/about/support.html",text:"Support",text_small:"Help"}]},"collapsible-menu":{},"language-picker":{"grid-columns":3},youtube:{},search:{},"html-minifier":{customAttrSurround:[],removeScriptTypeAttributes:!1,removeEmptyAttributes:!1,removeRedundantAttributes:!1,removeEmptyElements:!1,sortClassName:!0,caseSensitive:!0,html5:!0,collapseWhitespace:!0,processConditionalComments:!1,quoteCharacter:null,keepClosingSlash:!0,preventAttributesEscaping:!1,minifyURLs:!1,removeAttributeQuotes:!1,decodeEntities:!1,trimCustomFragments:!1,customAttrAssign:[],includeAutoGeneratedTags:!0,collapseInlineTagWhitespace:!1,collapseBooleanAttributes:!0,minifyJS:!0,removeTagWhitespace:!0,preserveLineBreaks:!1,sortAttributes:!0,removeStyleLinkTypeAttributes:!1,removeComments:!0,minifyCSS:!0,processScripts:[],conservativeCollapse:!1,removeOptionalTags:!1,useShortDoctype:!1},lunr:{maxIndexSize:1e6,ignoreSpecialCharacters:!1},fontsettings:{theme:"white",family:"sans",size:2},richquotes:{tip:{alert:"success",picto:"fa-thumbs-o-up"}},highlight:{},favicon:"favicon.ico","page-toc-button":{},"theme-api":{languages:[{lang:"c",name:"C/C++",default:!0},{lang:"python",name:"Python"},{lang:"js",name:"JavaScript"},{lang:"go",name:"Go"}],split:!0,theme:"light"},"bulk-redirect":{basepath:"/",redirectsFile:"redirects.json"},"custom-favicon":{},toolbar:{buttons:[{label:"Bug tracker",icon:"fa fa-bug",position:"left",url:"https://github.com/mavlink/mavlink-devguide/issues/new?title=Doc+Bug:+{{title}}&body=DESCRIBE+PROBLEM+WITH+DOCS+HERE%0A%0ABug+Page:+[{{title}}]({{url}})"},{label:"GitHub",icon:"fa fa-github",url:"https://github.com/mavlink/mavlink-devguide"},{label:"Edit page on github",icon:"fa fa-pencil-square-o",position:"left",url:"https://github.com/mavlink/mavlink-devguide/edit/master/{{filepath_lang}}"}]},sharing:{facebook:!0,twitter:!0,google:!1,weibo:!1,instapaper:!1,vk:!1,all:["facebook","google","twitter","weibo","instapaper"]},"theme-default":{styles:{website:"styles/website.css",pdf:"styles/pdf.css",epub:"styles/epub.css",mobi:"styles/mobi.css",ebook:"styles/ebook.css",print:"styles/print.css"},showLevel:!1},anchors:{}},theme:"default",pdf:{pageNumbers:!0,fontSize:12,fontFamily:"Arial",paperSize:"a4",chapterMark:"pagebreak",pageBreaksBefore:"/",margin:{right:62,left:62,top:56,bottom:56}},structure:{langs:"LANGS.md",readme:"README.md",glossary:"GLOSSARY.md",summary:"SUMMARY.md"},variables:{logo:"./assets/site/logo_mavlink_small.png"},title:"MAVLink Developer Guide",language:"ko",gitbook:"*"},file:{path:"mavgen_c/README.md",mtime:"2024-02-28T22:12:04.051Z",type:"markdown"},gitbook:{version:"3.2.3",time:"2024-02-28T22:12:55.236Z"},basePath:"..",book:{language:"ko"}})})</script></div><script src="../../gitbook/gitbook.js"></script><script src="../../gitbook/theme.js"></script><script src="../../gitbook/gitbook-plugin-collapsible-menu/plugin.js"></script><script src="../../gitbook/gitbook-plugin-page-toc-button/plugin.js"></script><script src="../../gitbook/gitbook-plugin-language-picker/plugin.js"></script><script src="../../gitbook/gitbook-plugin-toolbar/buttons.js"></script><script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script><script src="../../gitbook/gitbook-plugin-search/search.js"></script><script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script><script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script><script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script><script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script><script src="../../gitbook/gitbook-plugin-theme-api/theme-api.js"></script></body></html>